PS /Users/vglazhevskyi/Learning/azure-fundamentals-23/07> ./keyvault.ps1

1. Create a resource group and key vault
{
  "id": "/subscriptions/43aa0595-8fda-44a4-b227-f3733785e5c2/resourceGroups/resourcegroup-s0dxcf9",
  "location": "eastus",
  "managedBy": null,
  "name": "resourcegroup-s0dxcf9",
  "properties": {
    "provisioningState": "Succeeded"
  },
  "tags": null,
  "type": "Microsoft.Resources/resourceGroups"
}
2. Create a KeyVault
{
  "id": "/subscriptions/43aa0595-8fda-44a4-b227-f3733785e5c2/resourceGroups/resourcegroup-s0dxcf9/providers/Microsoft.KeyVault/vaults/keyvault-s0dxcf9",
  "location": "eastus",
  "name": "keyvault-s0dxcf9",
  "properties": {
    "accessPolicies": [
      {
        "applicationId": null,
        "objectId": "c7af2373-76f0-4ca6-8db6-be9a1303967d",
        "permissions": {
          "certificates": [
            "all"
          ],
          "keys": [
            "all"
          ],
          "secrets": [
            "all"
          ],
          "storage": [
            "all"
          ]
        },
        "tenantId": "8d3eeb6d-4534-4933-a2f1-019d9e341771"
      }
    ],
    "createMode": null,
    "enablePurgeProtection": null,
    "enableRbacAuthorization": null,
    "enableSoftDelete": true,
    "enabledForDeployment": false,
    "enabledForDiskEncryption": null,
    "enabledForTemplateDeployment": null,
    "hsmPoolResourceId": null,
    "networkAcls": null,
    "privateEndpointConnections": null,
    "provisioningState": "Succeeded",
    "publicNetworkAccess": "Enabled",
    "sku": {
      "family": "A",
      "name": "standard"
    },
    "softDeleteRetentionInDays": 90,
    "tenantId": "8d3eeb6d-4534-4933-a2f1-019d9e341771",
    "vaultUri": "https://keyvault-s0dxcf9.vault.azure.net/"
  },
  "resourceGroup": "resourcegroup-s0dxcf9",
  "systemData": {
    "createdAt": "2023-06-20T20:30:21.576000+00:00",
    "createdBy": "glajik@live.com",
    "createdByType": "User",
    "lastModifiedAt": "2023-06-20T20:30:21.576000+00:00",
    "lastModifiedBy": "glajik@live.com",
    "lastModifiedByType": "User"
  },
  "tags": {},
  "type": "Microsoft.KeyVault/vaults"
}
3. Populate your KeyVault with a secret
{
  "attributes": {
    "created": "2023-06-20T20:30:58+00:00",
    "enabled": true,
    "expires": null,
    "notBefore": null,
    "recoverableDays": 90,
    "recoveryLevel": "Recoverable+Purgeable",
    "updated": "2023-06-20T20:30:58+00:00"
  },
  "contentType": null,
  "id": "https://keyvault-s0dxcf9.vault.azure.net/secrets/vmAdminPassword/6cdd4546876d44afb1bd2982a2bfff42",
  "kid": null,
  "managed": null,
  "name": "vmAdminPassword",
  "tags": {
    "file-encoding": "utf-8"
  },
  "value": "mgivx/mcnPG0BduwI64qUeBc5etyLke6yDGiIbBYrR4="
}
4. Get the secret from KeyVault
5. Create VM using secret from KeyVault
Ignite (November) 2023 onwards "az vm/vmss create" command will deploy Gen2-Trusted Launch VM by default. To know more about the default change and Trusted Launch, please visit https://aka.ms/TLaD
It is recommended to use parameter "--public-ip-sku Standard" to create new VM with Standard public IP. Please note that the default public IP used for VM creation will be changed from Basic to Standard in the future.
Consider using the "Ubuntu2204" alias. On April 30, 2023,the image deployed by the "UbuntuLTS" alias reaches its end of life. The "UbuntuLTS" will be removed with the breaking change release of Fall 2023.
{
  "fqdns": "",
  "id": "/subscriptions/43aa0595-8fda-44a4-b227-f3733785e5c2/resourceGroups/resourcegroup-s0dxcf9/providers/Microsoft.Compute/virtualMachines/vm-s0dxcf9",
  "location": "eastus",
  "macAddress": "00-0D-3A-4E-38-F6",
  "powerState": "VM running",
  "privateIpAddress": "10.0.0.4",
  "publicIpAddress": "40.121.48.152",
  "resourceGroup": "resourcegroup-s0dxcf9",
  "zones": ""
}
